# GSE Import - Regras de GovernanÃ§a ALSHAM-360-PRIMA

## ğŸš¨ REGRAS CRÃTICAS - ZERO TOLERÃ‚NCIA

### 1. ZERO HARDCODED - Dados e ConfiguraÃ§Ãµes

**NUNCA hardcode:**
- âŒ Valores de impostos (II, IPI, PIS/COFINS, ICMS)
- âŒ CÃ³digos NCM
- âŒ URLs de marketplaces (eBay, RockAuto, Taobao, etc.)
- âŒ Taxas de cÃ¢mbio
- âŒ Margens de lucro
- âŒ Prazos de entrega
- âŒ Limites de valores
- âŒ Status colors (usar CSS variables)

**SEMPRE usar:**
- âœ… VariÃ¡veis de ambiente (`.env`)
- âœ… ConfiguraÃ§Ãµes no Supabase (tabela `settings` ou `config`)
- âœ… CSS variables para cores (Design System)
- âœ… Constantes em arquivos de config (`src/lib/config/`)
- âœ… Queries ao banco para dados dinÃ¢micos

**Exemplo ERRADO:**
```typescript
const taxRate = 0.20; // âŒ HARDCODED
const ncm = "8708.99.90"; // âŒ HARDCODED
const ebayUrl = "https://ebay.com"; // âŒ HARDCODED
```

**Exemplo CORRETO:**
```typescript
const taxRate = await getTaxRate(ncmCode); // âœ… Do banco
const ncm = await classifyNCM(partName); // âœ… IA ou banco
const marketplaceUrl = config.marketplaces.ebay.url; // âœ… Config
```

### 2. ZERO MOCK DATA - Dados Reais Apenas

**NUNCA usar:**
- âŒ `mockData`, `fakeData`, `dummyData`, `sampleData`
- âŒ `TODO`, `FIXME`, `HACK`, `XXX`
- âŒ Placeholders como `"test"`, `"example"`, `"placeholder"`
- âŒ Dados estÃ¡ticos em componentes (exceto exemplos em docs)

**SEMPRE usar:**
- âœ… Queries reais ao Supabase
- âœ… Dados de APIs reais (Serper, OpenAI, etc.)
- âœ… Testes com dados reais (ambiente de staging)
- âœ… Se precisar de dados de exemplo, usar seed scripts com dados realistas

**ValidaÃ§Ã£o prÃ©-commit:**
```bash
# Verificar palavras proibidas
grep -r "mock\|fake\|dummy\|TODO\|FIXME\|HACK" src/ --exclude-dir=node_modules
# Deve retornar zero resultados
```

### 3. Supabase - Filtro org_id ObrigatÃ³rio

**TODAS as queries devem incluir filtro de organizaÃ§Ã£o:**
```typescript
// âŒ ERRADO - Sem filtro org_id
const orders = await supabase
  .from('orders')
  .select('*');

// âœ… CORRETO - Com filtro org_id
const orders = await supabase
  .from('orders')
  .select('*')
  .eq('org_id', currentOrgId); // OBRIGATÃ“RIO
```

**RLS (Row Level Security) deve estar ativo:**
- Todas as tabelas devem ter RLS habilitado
- Policies devem verificar `org_id` ou `user_id`
- Nunca desabilitar RLS em produÃ§Ã£o

### 4. Arquitetura de Agentes - Squad Pattern

**Agentes seguem arquitetura de squad:**

**CORE Squad (Operacional):**
- `Concierge` - IdentificaÃ§Ã£o e comunicaÃ§Ã£o com cliente
- `Hunter` - Busca global de peÃ§as
- `Fiscal` - CÃ¡lculo de impostos e classificaÃ§Ã£o NCM
- `Auditor` - ValidaÃ§Ã£o de fotos e qualidade

**GUARD Squad (SeguranÃ§a):**
- `Guard` - Antifraude, validaÃ§Ã£o de pagamentos, anÃ¡lise de risco
- `Escrow` - GestÃ£o de Smart Escrow (pagamento em garantia)

**ANALYST Squad (InteligÃªncia):**
- `Analyst` - AnÃ¡lise de margem, otimizaÃ§Ã£o de rotas, previsÃµes

**Estrutura de pastas:**
```
src/agents/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ concierge/
â”‚   â”œâ”€â”€ hunter/
â”‚   â”œâ”€â”€ fiscal/
â”‚   â””â”€â”€ auditor/
â”œâ”€â”€ guard/
â”‚   â”œâ”€â”€ antifraud/
â”‚   â””â”€â”€ escrow/
â””â”€â”€ analyst/
    â”œâ”€â”€ margin/
    â””â”€â”€ optimization/
```

### 5. Design System - Borderless Premium Gearhead

**Cores - CSS Variables OBRIGATÃ“RIO:**
```css
/* âŒ ERRADO - Hardcoded */
.button { background: #00FF88; }

/* âœ… CORRETO - CSS Variable */
.button { background: var(--color-primary); }
```

**VariÃ¡veis definidas em `src/styles/design-system.css`:**
```css
:root {
  /* Primary - Neon Green Gearhead */
  --color-primary: #00FF88;
  --color-primary-dark: #00CC70;
  --color-primary-light: #1AFF8D;
  
  /* Background - Dark Mode First */
  --color-bg-base: #0A0A0A;
  --color-bg-elevated: #111111;
  --color-bg-card: #1A1A1A;
  
  /* Status Colors */
  --color-success: var(--color-primary);
  --color-warning: #FFB800;
  --color-error: #FF4444;
  --color-info: #0A84FF;
  
  /* Borders */
  --color-border: #2A2A2C;
  --color-border-light: #3A3A3C;
}
```

**Componentes - shadcn/ui OBRIGATÃ“RIO:**
- âœ… Usar componentes do shadcn/ui
- âœ… Customizar via CSS variables
- âœ… Nunca criar componentes do zero (usar shadcn como base)
- âœ… Dark mode first (todos os componentes devem funcionar em dark)

**Tailwind Config:**
```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: 'var(--color-primary)',
          dark: 'var(--color-primary-dark)',
          light: 'var(--color-primary-light)',
        },
        // ... outras cores via CSS variables
      },
    },
  },
}
```

### 6. Stack TecnolÃ³gica - Definida e ImutÃ¡vel

**Frontend:**
- Next.js 15 (App Router)
- TypeScript (strict mode)
- Tailwind CSS
- shadcn/ui
- React Hook Form + Zod

**Backend:**
- Supabase (PostgreSQL + Auth + Storage + Realtime)
- Drizzle ORM (type-safe queries)
- n8n (orquestraÃ§Ã£o de workflows)

**IA:**
- AbstraÃ§Ã£o provider-agnostic (ver `governance/AI_ABSTRACTION.md`)
- Suporte: OpenAI, Anthropic, Google, Grok

**ValidaÃ§Ã£o prÃ©-commit:**
```bash
# Verificar imports nÃ£o permitidos
grep -r "from 'react-query'" src/ # âŒ Usar TanStack Query
grep -r "styled-components" src/ # âŒ Usar Tailwind + shadcn
```

### 7. Status Colors - VariÃ¡veis CSS

**NUNCA hardcode status colors:**
```typescript
// âŒ ERRADO
const statusColor = order.status === 'paid' ? '#00FF88' : '#FF4444';

// âœ… CORRETO
const statusColor = `var(--color-${order.status})`; // success, error, etc.
```

**Mapeamento de status:**
- `pending` â†’ `--color-warning`
- `paid` â†’ `--color-success`
- `shipped` â†’ `--color-info`
- `delivered` â†’ `--color-success`
- `cancelled` â†’ `--color-error`

### 8. ValidaÃ§Ã£o PrÃ©-Commit

**Scripts obrigatÃ³rios em `.husky/pre-commit`:**
```bash
#!/bin/sh

# 1. Verificar palavras proibidas
echo "ğŸ” Verificando palavras proibidas..."
if grep -r "mock\|fake\|dummy\|TODO\|FIXME\|HACK" src/ --exclude-dir=node_modules; then
  echo "âŒ Palavras proibidas encontradas!"
  exit 1
fi

# 2. Verificar hardcoded colors
echo "ğŸ¨ Verificando hardcoded colors..."
if grep -r "#[0-9A-Fa-f]\{6\}" src/ --exclude-dir=node_modules | grep -v "var(--"; then
  echo "âŒ Cores hardcoded encontradas! Use CSS variables."
  exit 1
fi

# 3. Verificar queries sem org_id
echo "ğŸ” Verificando queries Supabase..."
# (adicionar validaÃ§Ã£o especÃ­fica)

# 4. TypeScript check
echo "ğŸ“˜ Verificando TypeScript..."
npm run type-check

# 5. Lint
echo "ğŸ§¹ Executando linter..."
npm run lint
```

### 9. Estrutura de Pastas - SSOT (Single Source of Truth)

**OrganizaÃ§Ã£o obrigatÃ³ria:**
```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                 # shadcn/ui components
â”‚   â”œâ”€â”€ core/               # Componentes core do GSE
â”‚   â””â”€â”€ layout/             # Layout components
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ ai/                 # AbstraÃ§Ã£o de IA (provider-agnostic)
â”‚   â”œâ”€â”€ supabase/            # Cliente Supabase + queries
â”‚   â”œâ”€â”€ config/              # ConfiguraÃ§Ãµes (nÃ£o hardcoded)
â”‚   â””â”€â”€ utils/               # UtilitÃ¡rios
â”œâ”€â”€ agents/                  # Agentes (squad pattern)
â”œâ”€â”€ hooks/                   # React hooks customizados
â””â”€â”€ types/                   # TypeScript types (shared)
```

**SSOT para:**
- ConfiguraÃ§Ãµes â†’ `src/lib/config/`
- Tipos compartilhados â†’ `src/types/`
- Constantes â†’ `src/lib/constants.ts` (apenas se nÃ£o vierem do banco)
- Design tokens â†’ `src/styles/design-system.css`

### 10. Testes - Zero Mock Policy

**Testes devem usar:**
- âœ… Dados reais do Supabase (ambiente de staging)
- âœ… Mocks apenas de APIs externas (Serper, Stripe, etc.)
- âœ… Testes de integraÃ§Ã£o com dados reais

**NUNCA:**
- âŒ Mock de dados do Supabase
- âŒ Dados fake em testes de integraÃ§Ã£o
- âŒ Placeholders em testes

## ğŸ“‹ Checklist ObrigatÃ³rio Antes de Commit

- [ ] Zero hardcoded (impostos, NCM, URLs, cores)
- [ ] Zero mock data (apenas dados reais)
- [ ] Queries Supabase com filtro org_id
- [ ] Cores via CSS variables
- [ ] Componentes shadcn/ui (nÃ£o criar do zero)
- [ ] TypeScript strict mode (sem `any`)
- [ ] ValidaÃ§Ã£o prÃ©-commit passou
- [ ] Testes com dados reais

## ğŸš¨ ViolaÃ§Ãµes = RejeiÃ§Ã£o Imediata

Qualquer violaÃ§Ã£o destas regras resulta em:
1. RejeiÃ§Ã£o do PR
2. CorreÃ§Ã£o obrigatÃ³ria
3. RevisÃ£o da governanÃ§a se necessÃ¡rio

**Estas regras sÃ£o INVOLÃVEIS. NÃ£o hÃ¡ exceÃ§Ãµes.**



